{"filter":false,"title":"Untitled","tooltip":"/Untitled","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":144,"column":3},"action":"insert","lines":["############################################################################################################################","#Purpose of the script -> To Check the VOBs backup from local disk to LUN and if any issue it send the alert email to team #","############################################################################################################################","# Importing the SMTP protocl to send the email","require 'net/smtp'","#############################################","# Functionality for getting the Date and time","#############################################","","time = Time.now - (1 * 60 * 60 * 24)  # One day ago from current day","#ACG_Procurement_20160831","","# Components of a Time","","current_date=time.inspect","","puts current_date","","values = current_date.split(\" \")","","val=values.first","","str2 = val.gsub('-','')","","puts str2","","###########################################################","#Getting the log files location and date/time of the file #","###########################################################","$file_count=false #Counting the number of log files","#files = Dir[\"C:/Sites/CC_Log_Script/clearcaselog/Logs/*.log\"]","ary = ['Y','M']","ary.each do |drive|","","files = Dir[\"#{drive}:/*_#{str2}.log\"]","files.each do |file_name|","$file_count=true","    puts file_name","\tif !File.directory? file_name","\t\tdata = []","\t\tcount=0   ","\t\t$val=0","\t\t$name=file_name","File.foreach(file_name) do |line|","######################################","#   To find the error in log files   #","######################################","\t\tif line.upcase.include? \"ERROR\"","\t\t    $val=10 ","\t\t    #puts \"Passed\"","\t\t    #puts $val","\t\tend","#############################################","# To find the Failed value in the text file #","#############################################    ","line.chomp!","temp_line = line.delete(' ')","\t\tif temp_line =~ /TotalCopiedSkippedMismatchFAILEDExtras/","\t\t\tcount=count+1","\t\telse","\t\t\tif ((count > 0) & (count <= 3))","\t\t\t\tcount+=1","\t\t\t\tline = line.split('  ')","\t\t\t\tline.delete(\"\")","\t\t\t\tdata.push [line[5].strip.to_i]","\t\t\tend","\t\tend","\tend","data = data.flatten","puts data","puts $val","##########################################################","# To find the VOB Name where the Error / Failed occured  #","##########################################################","path=file_name","$fname = path.split(\"/\")","$fname=$fname.last","$max=data.max","if $max==nil","$max=0","end","\tif $max > 0 ||  $val > 0","\t    $val=0","\t\tputs \"Send Alert!!\"","##############################################################################","# To Send the email to team if Error / Failed occured in the backup log files# ","##############################################################################","message = <<MESSAGE_END","From: <selvaganapathi.m@hcl.com>","To: <HCL_AGILENT_SETOOLS_CLSLLS_SUPPORT@hcl.com>","MIME-Version: 1.0","Content-type: text/html","Subject: Attention","","<p>Hi Team,</p>","<p>The VOB backup from localdisk to LUN got failed. Please check the below log files and take the action.","</p> ","<p> File Name - #{$fname} </p>"," <p><b>Regards,</b></p>","  CC Admin","","MESSAGE_END","\t\t\tNet::SMTP.start('germany.smtp.agilent.com') do |smtp|","\t\t\t  smtp.send_message message,'selvaganapathi.m@hcl.com','vairamuthu-sh@hcl.com'                        #'selvaganapathi.m@hcl.com','HCL_AGILENT_SETOOLS_CLSLLS_SUPPORT@h#cl.com'                       ","\t\t\tend","","\telse","\t\tputs \"Do Nothing\"","\t\tputs $val","\tend","end","end","","puts $file_count","","##############################################################################","# To Send the email to team if the backup log files folder is empty          # ","##############################################################################","\tif $file_count == false","\t\tputs \"Send Alert!!\"","","message = <<MESSAGE_END","From: <selvaganapathi.m@hcl.com>","To: <HCL_AGILENT_SETOOLS_CLSLLS_SUPPORT@hcl.com>","MIME-Version: 1.0","Content-type: text/html","Subject: Attention!!! - LFSCC01 - VOB Backup logs from localdisk to LUN not found","","<p>Hi Team,</p>","<p>The VOB backup logs from localdisk to LUN folder is empty. Please check and take the action.","</p> ",""," <p><b>Regards,</b></p>","  CC Admin","","MESSAGE_END","\t\t\tNet::SMTP.start('germany.smtp.agilent.com') do |smtp|","\t\t\t  smtp.send_message message,'selvaganapathi.m@hcl.com','vairamuthu-sh@hcl.com'                        #'selvaganapathi.m@hcl.com','HCL_AGILENT_SETOOLS_CLSLLS_SUPPORT@h#cl.com'                       ","\t\t\tend","","\telse","\t\tputs \"Do Nothing\"","\t\tputs $val","\tend","end"],"id":1}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1476959083533,"hash":"d6e16258d72c3d75fbc647c69162b34b841a8cbe"}